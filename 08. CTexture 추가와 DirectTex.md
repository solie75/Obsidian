# CTexture 추가

- OutputFile/ bin/ content 폴더에 texture 폴더 생성하고 해당 폴더에 Fighter.bmp 파일 추가 (전투기 이미지로 배경은 마젠타)
- Engine Library/ Source/ 07.Resource 에 <span style="color: yellow">2. Testure 폴더 추가 후 CTexture class 생성</span>
	- CTexture 에 DirectXTex Library 참조
		- External/Include 와 External/Library 에 DirectXTex 폴더 생성
		- https://github.com/microsoft/DirectXTex 에서 Download ZIP으로 압축파일 다운로드
		- 다운받은 폴더의  DirectXTex_Desktip_2022.sln 실행
		- DirectXTex 프로젝트의 속성 -> 구성 : Debug -> 구성속성 일반 -> 일반속성 대상이름 -> DirectXTex_debug
		- DirectXTex 프로젝트를 Debug, Release 버전으로 빌드
		- 다운받은 폴더 (DirectXTex-main)/ DirectXTex/ Bin/ Desktop_2022/ (설정한 플랫폼) x64 의 Debug 와 Release 폴더 생성됨.
		- Debug 폴더의 DirectXTex_debug.lib 과 Release 폴더의 DirectXTex.lib 을 복사하여 External/Library/DirectXTex 에 붙여쓰기
		- DirectXTex-main/DirectXTex 의 DirectXTex.h 와 DirectXTex.inl 을 복사하여 External/Include/DirectXTex 에 붙여쓰기
		- Engine Library 속성 -> 구성 : 모든 구성 -> 구성 속성 VC++ 디렉터리 -> 포함 디렉터리 : $(SolutionDir)External\Include\ , 라이브러리 디렉터리 : $(SolutionDir)External\Library\DirectXTex\
	- CTexture.h
		- DirectXTex\DirectXTex.h 를 include 한다.
		- 전처리기( # ifdef _DEBUG)로 debug 와  release 일때를 나누어 각기 DirectXTex_debug.lib 과, DirectXTex.lib 를 # pragma comment 한다.
		- 맴버 변수 선언
			- ComPtr<ID3D11Texture2D.> 형 변수 (m_Texture2D)
			- ComPtr<ID3D11ShaderResourceView.> 형 변수 (m_ShaderResourceView)
			- D3D_TEXTURE2D_DESC 형 변수 (m_DESC)
			- ScratchImage 형 변수(m_Image) https://github.com/microsoft/DirectXTex/wiki/Image
		- 텍스쳐 저장 및 불러오기 함수
			- 부모 클라스인 CResource class 에서 LoadResourceData(const wstring& _strFilePath) 와 SaveResourceData(const wstring& _strRelativePath) 함수를 순수가상함수로 선언. 이때 Save 는 public 으로 Load 는 private 로 선언한다.
				- CResource class 를 부모 클라스로 둔 CMesh 와 CShader 에도 LoadResourceData() 와  SaveResourceData() 를 override
			- CTexture::LoadResourceData(const wstring& _strFilePath) 에서
				- wchar_t 형 배열 변수 (szExt) 생성 후 L"" 대입
				- [[_splitpath_s, _wstplitpath_s|_wsplitpath_s]] 함수로  로드할 리소스의 주소의 확장자를 szExt 에 저장한다.
				- [[LoadFromDDSFile, LoadFromTGAFile, LoadFromWICFile|확장자에 따라 파일을 로드하는 함수]]를 호출한다.
				- 해당 함수로 m_Image 에 리소스 데이터 저장
				- 파일 불러오기 실패시 E_FAIL 반환
				- [[CreateShaderResourceView( )]] 을 호출하여 shader resource view 를 생성 및 m_ShaderResourceView 에 저장
				- CreateShaderResourceView 가 실패시 E_FAIL 반환
				- m_ShaderResourceView 에 대해 [[ID3D11ShaderResourceView#^e11af7|GetResource(m_Texture2D.GetAddressOf())]] 호출
				- m_Texture2D 에 대해 [[ID3D11Texture2D#^e22223|GetDesc(&m_Desc)]] 호출
		- UpdateResourceData() 를  override
		- UpdateTextureData(int _iRegisterNum) 선언
			- CONTEXT 에 대해 PSSetShaderResource 를 호출하여 shader resource 의 배열 (m_shaderResourceView)을 pixel shader stage 에 바인딩한다.
		- <span style="color: ">이때 UpdateResourceData() 함수의 경우 어떻게 사용되는 걸까..(현재 내용 없음)</span>

# CResourceMgr 수정

- CResourceMgr.h 에 CTexture.h 를 include
- GetResourceType() 에 다음 추가
```c++
const type_info& texture = typeid(CTexture);
if(typeid(T).hash_code()==texture.hash_code())
{
	return RESOURCE_TYPE::TEXTURE;
}
```
- LoadDefaultTexture() 추가
	- Ptr<CTexture.> 형 변수 pTexture 선언 후 해당 변수에 LoadResource<CTexture.>()로 Fight.bmp 를 로드한다.
	- pTexture 에 대해서 UpdateTextureData(0) 를 호출하여 Pixel stage에 해당 resource 를 바인딩한다.
- ResourceMgrInit() 에서 LoadDefaultTexture() 호출