DirectX3D 3일차 Light3D

CLight3D.h 생성

광원의 구조체 안에는 광원의 색상 구조체가 따로 있다.
빛의 색상, 환경광 세기

빛 설정 할 때 난반사를 색상으로 본다.

빛의 유형, 빛의 반경, 빛의 각도 에 대한 세팅 함수 추가

Light3D 컴포넌트를 추가하여 광원 추가

final tick 의 render Mgr 에 등록

LightInfo 구조화 버퍼 추가

RenderMgrInit() 에서 Light3DBuffer  구조화 버퍼 생성
Read Only 는 UAV 를 만들지 않는다,  t Register 에만 바인딩 하겠다는 것, true 는 System Access 사용 여부이다,  매 틱마다 레벨상에 존재하는 광원들의 정보가 달라지면 그 때마다 RenderMgr 는 모든 광원의 정보를 취합해서 구조화 버퍼로 보내고 보낸 정보를 레지스터에 바인딩한다.

글로벌 변수에 3D 광원 개수 정보 세팅
해당 광원의 정보는 구조체 버퍼에 담아 사용한다.

CRenderMgr::UPdate() 에서 구조화 버퍼의 크기가 모자라면 더 크게 만들기 위해서 
Create() 함수를 호출한다. 이때 구조화 멤버의 각 요소들을 nullptr 로 채워버리면 해당의 요소들이 모두 ComPtr 이기 때문에 기존에 가리키던 것들의 RefCount 가 0 이 되면서 알아서 메모리가 해제되어 버린다.
그 뒤 다시 구조화 버퍼를 만든다.

finaltick() 에서 Transform 의 위치와 방향 정보를 가져온다.

가져온 정보를 RenderMgr 에 등록한다. 

renderMgr 는 모든 광원을 받아서 모든 레지스터를 모아서 구조화 버퍼에 담아서 보내준다.

 <광원의 종류>
1. Directional (태양광)
2. Point (전구)
3. Spot ( 원뿔형 )


광원 계산
어느 위치에서 어느 세기로 나에게 빛이 왔는지

재질 계수

point light 는 환경광을 0으로 한다. (태양광에서만  환경광을 있게한다.)
viewspace 에서의 광원의위치 

거리에 따른 빛의 세기 조절

거리를 반경으로 나눈 것을 세기로 한다. 하지만 가까울 수록 세야 하므로 1에서 거리를 반경으로 나눈 값을 빼서 가까운 정도에 따라서 가까울 수록 온전히 1이 되게 끔 계산한다.

spotlight 는 과제



 